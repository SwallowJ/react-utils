!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("@swallowj/logjs")):"function"==typeof define&&define.amd?define(["@swallowj/logjs"],r):"object"==typeof exports?exports["react-utils-script"]=r(require("@swallowj/logjs")):e["react-utils-script"]=r(e["@swallowj/logjs"])}(global,(function(e){return(()=>{"use strict";var r,t={702:(e,r,t)=>{t.r(r),t.d(r,{entrance:()=>b,loadModel:()=>x,loadRouter:()=>g});const o=require("fs");var n=t.n(o);const s=require("path");var i=t.n(s);const c=/(namespace)(\S|\s)*(state:)(\S|\s)*(effects:)(\S|\s)*(reducers:)(\S|\s)*(export default).*/,a=e=>{const r=n().readFileSync(e,{encoding:"utf8"});return c.test(r)};var l=t(460),u=t.n(l);const d=require("child_process"),p=require("crypto");var f=t.n(p);const m=e=>(o.rmSync(e,{force:!0,maxRetries:3}),o.mkdirSync(s.dirname(e),{recursive:!0}),o.createWriteStream(e)),w=new Map,$=u().New({name:"model"}),y=e=>i().resolve(process.cwd(),"src",e),v=(e,r)=>{$.Info(`开始扫描目录列表: ${e}`);const t=[];for(;e.length>0;){const o=e.shift();o&&n().readdirSync(o).forEach((s=>{const c=i().resolve(o,s);n().statSync(c).isFile()?r&&!r.test(s)||/\.[jt]sx?$/.test(i().extname(s))&&a(c)&&t.push(c):e.push(c)}))}return t},x=e=>{const{watch:r=!1,pages:t=y("pages"),output:o,customes:s=[y("models")],namespace:c=""}=e;if(!n().statSync(t).isDirectory())throw new Error(`${t} 不是一个目录`);s.forEach((e=>{if(!n().existsSync(e))throw new Error(`目录/文件 ${e} 不存在`)}));const a=i().resolve(o,c,"model.ts"),l=[...v([...s]),...v([t],/model\.[tj]sx?$/)];if(((e,r)=>{const t=m(e);r.forEach((e=>{const r=e.replace(/\.[jt]sx?$/,"");t.write(`export { default as ${(e=>{let r=w.get(e);r||(r=f().createHash("sha256").update(e).copy().digest("hex").slice(0,8),w.set(e,r));let t="";for(const r of e.split(i().sep).reverse())if("model"!==r){t=r.replace(/\s/g,"_");break}return`${t}_${r}`})(r)} } from "${r}";\n`)})),t.close()})(a,l),r){const e=i().resolve(__dirname,"modellistener");(0,d.fork)(e).send({pages:t,customes:s,output:a,initArry:l})}$.Info("model 加载完成")},h=(e,r,t)=>{const o=new Array(t).fill("\t").join(""),n=new Array(t+1).fill("\t").join("");switch(Object.prototype.toString.call(e)){case"[object String]":return void r?.write(`"${e}",`);case"[object Object]":return r?.write("{\n"),Object.entries(e).forEach((([e,o])=>{r?.write(`${n}${e}: `),h(o,r,t+2)})),void r?.write(`\n${o}},`);case"[object Array]":return r?.write("["),e.forEach((e=>{h(e,r,t+2)})),void r?.write("],");default:return void r?.write(`${e},`)}},j=(e,r,t,o=1,n="/")=>{const s=new Array(o).fill("\t").join(""),c=new Array(o+1).fill("\t").join("");e.forEach((e=>{const a=i().resolve(n,e.path.replace(/^\//,""));r.write(`${s}{\n`),Object.entries(e).forEach((([e,n])=>{switch(e){case"routers":return r.write(`${c}${e}: [\n`),j(n,r,t,o+2,a),void r.write(`${c}],\n`);case"component":return void(t?r.write(`${c}${e}: loadable(() => import("${n}"), options),\n`):r.write(`${c}${e}: require("${n}").default,\n`));case"data":return r.write(`${c}${e}: `),h(n,r,o+1),void r.write("\n");case"exact":return void r.write(`${c}${e}: ${n},\n`);case"redirect":default:return void r.write(`${c}${e}: "${n}",\n`);case"path":return void r.write(`${c}${e}: "${a}",\n`)}})),r?.write(`${s}},\n`)}))},g=e=>{const{routerPath:r,namespace:o="",output:s,watch:c}=e;if(!n().statSync(r).isFile())throw new Error(`${r} 不存在`);const a=i().resolve(s,o,"routerConfig.tsx");t.e(786).then(t.bind(t,786)).then((t=>{const o=t.default(r),n={...e,output:a,routers:o};if((e=>{const{output:r,split:t=!0,loadComponent:o,routers:n}=e;if(t&&!o)throw new Error("loadComponent 不能为空");const s=m(r);t&&(s.write('import React from "react";\n'),s.write('import loadable from "@loadable/component";\n'),s.write(`import Loading from "${o}";\n\n`),s.write("const options = {\n\tfallback: <Loading />,\n};\n\n")),s.write("const routers: Aplication.router[] = [\n"),j(n,s,t),s.write("];\n\nexport default routers;\n"),s.close()})(n),c){const e=i().resolve(__dirname,"routerlistener");(0,d.fork)(e).send(n)}}))},S=(...e)=>i().resolve(__dirname,"../src",...e),b=e=>{const{output:r,namespace:t="",notFoundPage:o="./router/404",appPage:s="./router/app"}=e,c=i().resolve(r,t),a=i().resolve(r,"model.ts"),l=i().resolve(c,"routerConfig.tsx"),u=i().resolve(c,"index.tsx");n().mkdirSync(c,{recursive:!0}),n().existsSync(a)||n().copyFileSync(S("model.ts"),a),n().existsSync(l)||n().copyFileSync(S("namespace","routerConfig.tsx"),l),(0,d.execSync)(`cp -r ${S("reducer")} ${r}`),(0,d.execSync)(`cp -r ${S("namespace","router")} ${c}`),n().copyFileSync(S("namespace","index.tsx"),u);const p=m(i().resolve(c,"pages.ts"));p.write(`export { default as Application } from "${s}";\n`),p.write(`export { default as NotFoundPage } from "${o}";\n`),p.close()}},460:r=>{r.exports=e}},o={};function n(e){var r=o[e];if(void 0!==r)return r.exports;var s=o[e]={id:e,loaded:!1,exports:{}};return t[e](s,s.exports,n),s.loaded=!0,s.exports}return n.m=t,n.c=o,n.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return n.d(r,{a:r}),r},n.d=(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.f={},n.e=e=>Promise.all(Object.keys(n.f).reduce(((r,t)=>(n.f[t](e,r),r)),[])),n.u=e=>"dynamicImport.js",n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r={179:1},n.f.require=(e,t)=>{r[e]||(e=>{var t=e.modules,o=e.ids,s=e.runtime;for(var i in t)n.o(t,i)&&(n.m[i]=t[i]);s&&s(n);for(var c=0;c<o.length;c++)r[o[c]]=1})(require("./"+n.u(e)))},n(702)})()}));